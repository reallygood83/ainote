# 배움의 달인 코드 사이닝 해결 방안 📝

## 🎯 현재 상황

**문제**: macOS 앱 실행 시 Rust 네이티브 모듈(`rust_png`) 때문에 크래시 발생
- 원인: 서명되지 않은(unsigned) 네이티브 바이너리
- 증상: `EXC_BREAKPOINT (SIGTRAP)` 에러
- 영향: macOS 사용자가 앱을 바로 실행할 수 없음

---

## 💡 3가지 해결 방안

### 방안 1: Apple Developer 계정으로 정식 서명 (권장) ⭐

#### 📋 준비 사항
1. **Apple Developer Program 가입** ($99/년)
   - 웹사이트: https://developer.apple.com/programs/
   - 개인 또는 조직 계정 선택
   - 신청 후 승인까지 1-2일 소요

2. **Developer ID Application 인증서 발급**
   - Xcode 또는 Apple Developer Portal에서 발급
   - Mac에 설치하면 자동으로 Keychain에 등록

#### 🔧 구현 방법

1️⃣ **electron-builder 설정 업데이트**

`app/build/electron-builder-config.js` 파일 수정:

```javascript
module.exports = {
  appId: "com.kimmonjung.learningmaster",
  productName: "배움의 달인",

  // 코드 사이닝 설정 추가
  mac: {
    target: ["dmg", "zip"],
    arch: ["arm64"],
    category: "public.app-category.education",

    // ✅ 코드 사이닝 활성화
    identity: "Developer ID Application: 김문정 (TEAM_ID)",
    hardenedRuntime: true,
    gatekeeperAssess: false,
    entitlements: "build/entitlements.mac.plist",
    entitlementsInherit: "build/entitlements.mac.plist",

    // 공증(Notarization) 설정
    notarize: {
      teamId: "YOUR_TEAM_ID"
    }
  }
};
```

2️⃣ **Entitlements 파일 생성**

`app/build/entitlements.mac.plist` 생성:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <!-- Hardened Runtime 필수 권한 -->
    <key>com.apple.security.cs.allow-unsigned-executable-memory</key>
    <true/>
    <key>com.apple.security.cs.disable-library-validation</key>
    <true/>

    <!-- JIT 컴파일 허용 (V8 엔진) -->
    <key>com.apple.security.cs.allow-jit</key>
    <true/>

    <!-- 네트워크 접근 -->
    <key>com.apple.security.network.client</key>
    <true/>
    <key>com.apple.security.network.server</key>
    <true/>
</dict>
</plist>
```

3️⃣ **환경 변수 설정**

`.env` 파일 또는 CI/CD에 추가:

```bash
# Apple ID (공증용)
APPLE_ID=your-email@example.com
APPLE_APP_SPECIFIC_PASSWORD=xxxx-xxxx-xxxx-xxxx

# Team ID (Developer Portal에서 확인)
APPLE_TEAM_ID=XXXXXXXXXX
```

4️⃣ **빌드 및 공증**

```bash
# 서명 + 공증 자동 수행
cd /Users/moon/Desktop/surf-main/app
npm run build:mac:arm
```

#### ✅ 장점
- ✨ 완벽한 해결: 사용자가 바로 실행 가능
- 🔒 보안: Apple의 공식 검증 통과
- 📱 배포: Mac App Store 등록 가능
- 🎯 신뢰도: "확인된 개발자" 표시

#### ❌ 단점
- 💰 비용: $99/년
- ⏰ 시간: 계정 승인 1-2일 + 인증서 발급 1시간
- 📚 복잡도: 설정 과정이 다소 복잡

---

### 방안 2: Self-Signed 인증서로 임시 서명 (중간 해법) 🔧

Apple Developer 계정 없이 자체 서명 인증서 사용

#### 🔧 구현 방법

1️⃣ **Self-Signed 인증서 생성**

```bash
# 인증서 생성 (Keychain Access에서도 가능)
security create-keychain -p "password" build.keychain
security default-keychain -s build.keychain
security unlock-keychain -p "password" build.keychain

# 코드 사이닝 인증서 생성
security add-certificate -k build.keychain cert.p12 -P "cert_password"
```

2️⃣ **electron-builder 설정**

```javascript
mac: {
  identity: null, // 자동 탐지
  hardenedRuntime: false, // Self-signed는 hardened 비활성화
}
```

3️⃣ **빌드 후 수동 서명**

```bash
# 빌드
npm run build:mac:arm

# 앱 번들 서명
codesign --force --deep --sign "Your Self-Signed Identity" \
  "dist/배움의 달인.app"

# 네이티브 모듈 서명
find "dist/배움의 달인.app" -name "*.node" -exec \
  codesign --force --sign "Your Self-Signed Identity" {} \;
```

#### ✅ 장점
- 💰 무료
- ⚡ 빠른 구현
- 🔧 개발/테스트용으로 적합

#### ❌ 단점
- ⚠️ 여전히 보안 경고 발생
- ❌ 공증 불가능
- 🚫 Mac App Store 배포 불가
- 👥 사용자는 여전히 수동 허용 필요

---

### 방안 3: 사용자 가이드 개선 (현실적 임시 방안) 📚

코드 사이닝 없이 사용자 경험 개선

#### 🔧 구현 방법

1️⃣ **자동 실행 스크립트 제공**

`fix-app.sh` 생성 및 배포:

```bash
#!/bin/bash
# 배움의 달인 실행 수정 스크립트

APP_PATH="/Applications/배움의 달인.app"

echo "🔧 배움의 달인 실행 권한 설정 중..."

# 격리 속성 제거
sudo xattr -cr "$APP_PATH"

# 실행 권한 부여
sudo chmod -R +x "$APP_PATH/Contents/MacOS/"

# Rust 네이티브 모듈 권한 수정
find "$APP_PATH" -name "*.node" -exec sudo chmod +x {} \;

echo "✅ 완료! 이제 앱을 실행해보세요."
```

2️⃣ **개선된 README 작성**

```markdown
## 🚀 macOS 빠른 실행 가이드

### 방법 1: 자동 스크립트 (권장)
1. [fix-app.sh 다운로드](링크)
2. 터미널에서 실행:
   ```bash
   chmod +x fix-app.sh
   ./fix-app.sh
   ```

### 방법 2: 수동 설정
1. 터미널 열기
2. 다음 명령어 복사 & 붙여넣기:
   ```bash
   sudo xattr -cr "/Applications/배움의 달인.app"
   ```
3. 비밀번호 입력
4. 앱 실행
```

3️⃣ **DMG에 스크립트 포함**

electron-builder 설정에 추가:

```javascript
mac: {
  dmg: {
    contents: [
      { x: 110, y: 150, type: "file" },
      { x: 440, y: 150, type: "link", path: "/Applications" },
      { x: 275, y: 300, type: "file", path: "fix-app.sh" }
    ]
  }
}
```

#### ✅ 장점
- 💰 완전 무료
- ⚡ 즉시 적용 가능
- 🎯 사용자 경험 개선
- 📦 스크립트 자동화

#### ❌ 단점
- 👤 여전히 사용자 액션 필요
- 🔐 보안 경고는 계속 표시
- 📱 Mac App Store 불가능

---

## 🎯 권장 로드맵

### 단기 (지금 당장)
✅ **방안 3 구현**: 자동 실행 스크립트 제공
- fix-app.sh 생성 및 GitHub 릴리즈에 추가
- README와 릴리즈 노트 개선
- 사용자 가이드 영상 제작 (선택)

### 중기 (1주일 내)
🔄 **Apple Developer 계정 신청**
- $99 결제 및 계정 생성
- Developer ID 인증서 발급 대기

### 장기 (계정 승인 후)
⭐ **방안 1 구현**: 정식 코드 사이닝
- electron-builder 설정 업데이트
- 공증(Notarization) 적용
- v1.0.1 재배포

---

## 📊 비교표

| 방안 | 비용 | 시간 | 사용자 경험 | 배포 가능성 | 추천도 |
|------|------|------|------------|-----------|--------|
| 방안 1: 정식 서명 | $99/년 | 2-3일 | ⭐⭐⭐⭐⭐ | Mac App Store 가능 | ⭐⭐⭐⭐⭐ |
| 방안 2: Self-Signed | 무료 | 1시간 | ⭐⭐ | GitHub만 가능 | ⭐⭐ |
| 방안 3: 가이드 개선 | 무료 | 30분 | ⭐⭐⭐ | GitHub만 가능 | ⭐⭐⭐⭐ (임시) |

---

## 🚀 즉시 실행 가능한 액션

바로 지금 할 수 있는 것:

1. ✅ **fix-app.sh 스크립트 생성**
2. ✅ **GitHub 릴리즈에 스크립트 추가**
3. ✅ **README 업데이트**
4. 🔄 **Apple Developer 계정 신청 시작**

---

**작성일**: 2025-10-28
**작성자**: Claude (SuperClaude Framework)
