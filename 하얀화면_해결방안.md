# 배움의 달인 - 하얀 화면 문제 해결

**증상**: 앱이 실행되지만 하얀 화면만 보이고 아무것도 표시되지 않음

**진단**: 2가지 근본 원인 확인됨

---

## 🔍 근본 원인 분석

### 1️⃣ Rust 네이티브 모듈 크래시 (이전 확인)
- `packages/backend/index.node` 서명 안 됨
- macOS SIP가 실행 차단
- 크래시 위치: `rust_png$cxxbridge1$ResultOfWriter$unwrap`

### 2️⃣ Renderer 프로세스 빌드 오류 (새로 확인)
```
[vite]: Rollup failed to resolve import "@deta/utils/formatting"
error during start dev server and electron app:
Error: No electron app entry file found: /Users/moon/Desktop/surf-main/app/out/main/index.js
```

**의미**: 프론트엔드(UI) 코드가 제대로 빌드되지 않음

---

## 🎯 해결 방안 (우선순위별)

### ✅ 방안 1: 빌드 오류 수정 후 재빌드 (가장 확실!)

#### 1단계: 의존성 문제 해결
```bash
cd /Users/moon/Desktop/surf-main

# @deta/utils 패키지 설치
yarn install --force

# packages/backend 빌드
cd packages/backend
npm run build

cd ../..
```

#### 2단계: 앱 재빌드
```bash
cd app
export PATH="/opt/homebrew/opt/node@22/bin:$PATH"

# 클린 빌드
rm -rf out dist node_modules/.vite
npm run build:mac:arm
```

#### 3단계: 테스트
```bash
# 새로 빌드된 DMG 설치
open dist/LearningMaster-1.0.0-arm64.dmg

# Applications에 드래그 후
xattr -cr "/Applications/배움의 달인.app"
chmod -R +x "/Applications/배움의 달인.app/Contents/MacOS/"
find "/Applications/배움의 달인.app" -name "*.node" -exec chmod +x {} \;

# 실행
open "/Applications/배움의 달인.app"
```

---

### ⚡ 방안 2: 개발 모드로 실행 (빠른 테스트)

Rust 모듈 문제를 우회하고 프론트엔드만 테스트:

```bash
cd /Users/moon/Desktop/surf-main/app

# 의존성 재설치
export PATH="/opt/homebrew/opt/node@22/bin:$PATH"
yarn install --force

# 개발 모드 실행
yarn dev
```

**주의**: 개발 모드도 Rust 모듈이 필요하면 같은 문제 발생 가능

---

### 🔧 방안 3: Electron DevTools로 에러 확인

앱이 하얀 화면으로 뜨면:

#### 개발자 도구 열기
```bash
# 앱 실행 후
# ⌘ + Option + I (맥)
# 또는 메뉴에서 View → Toggle Developer Tools
```

#### Console 탭 확인
```
❌ 예상 에러들:
- "Failed to load resource: app://./index.html"
- "Cannot find module 'backend'"
- "Uncaught Error: No such module"
```

이 에러들을 캡처해서 정확한 원인 파악!

---

### 🛠️ 방안 4: electron-builder 설정 확인

`app/build/electron-builder-config.js` 확인:

```javascript
mac: {
  category: "public.app-category.productivity",
  target: [
    {
      target: "dmg",
      arch: ["arm64"]
    }
  ],
  files: [
    "!**/.vscode/*",
    "!src/*",
    "!electron.vite.config.{js,ts,mjs,cjs}",
    "!{.eslintignore,.eslintrc.cjs,.prettierignore,.prettierrc.yaml,dev-app-update.yml,CHANGELOG.md,README.md}",
    "!{.env,.env.*,.npmrc,pnpm-lock.yaml}"
  ],
  asarUnpack: [
    "resources/**",
    "node_modules/@deta/backend/**"  // ⭐ Rust 모듈 언패킹
  ]
}
```

`asarUnpack`에 네이티브 모듈이 포함되어 있는지 확인!

---

## 🚀 즉시 시도해볼 명령어 (순서대로)

### 1차 시도: 빌드 오류 수정
```bash
cd /Users/moon/Desktop/surf-main

# 전체 의존성 재설치
yarn install --force

# backend 빌드
cd packages/backend && npm run build && cd ../..

# 앱 재빌드
cd app
export PATH="/opt/homebrew/opt/node@22/bin:$PATH"
rm -rf out dist node_modules/.vite
npm run build:mac:arm
```

### 2차 시도: 설치 및 권한 설정
```bash
# 새 DMG 마운트
open app/dist/LearningMaster-1.0.0-arm64.dmg

# Applications에 드래그 후
xattr -cr "/Applications/배움의 달인.app"
chmod -R +x "/Applications/배움의 달인.app/Contents/MacOS/"
find "/Applications/배움의 달인.app" -name "*.node" -exec chmod +x {} \;

# 실행
open "/Applications/배움의 달인.app"
```

### 3차 시도: 개발자 도구로 에러 확인
```bash
# 앱 실행 후 바로
# ⌘ + Option + I 눌러서 DevTools 열기
# Console 탭에서 에러 메시지 확인
```

---

## 📋 체크리스트

완전히 작동하는 앱 빌드를 위한 확인 사항:

- [ ] `yarn install` 성공 (모든 의존성 설치)
- [ ] `packages/backend` 빌드 성공 (Rust 모듈 생성)
- [ ] `app/out/main/index.js` 파일 존재 (Main 프로세스)
- [ ] `app/out/renderer/` 폴더 존재 (Renderer 프로세스)
- [ ] `app/dist/*.dmg` 파일 생성 (최종 빌드)
- [ ] DMG 마운트 및 설치 성공
- [ ] 권한 설정 완료 (xattr, chmod)
- [ ] 앱 실행 시 UI 표시됨 (하얀 화면 ❌)

---

## 🎯 Always Works™ 체크

- [ ] 실제로 앱을 실행했는가?
- [ ] UI가 제대로 표시되는가?
- [ ] 에러 메시지를 확인했는가?
- [ ] DevTools Console을 열어봤는가?
- [ ] $100 베팅 가능한가?

**현재 상태**: ❌ 하얀 화면 = Does NOT Work

---

## 💡 디버깅 팁

### Console 로그 캡처
```bash
# 앱 실행 시 로그 저장
open "/Applications/배움의 달인.app" 2>&1 | tee app_launch.log
```

### 빌드 출력 상세 확인
```bash
cd app
npm run build:mac:arm 2>&1 | tee build.log
```

### Electron 버전 확인
```bash
cd app
npm list electron
```

---

## 🔄 다음 단계

1. **즉시**: 위의 1차 시도 명령어 실행
2. **30분 내**: 재빌드 완료 후 테스트
3. **1시간 내**: 여전히 하얀 화면이면 DevTools로 정확한 에러 확인
4. **2시간 내**: 에러 메시지 기반으로 근본 원인 수정

---

**핵심 메시지**:
- 하얀 화면 = 프론트엔드 코드 로드 실패
- 크래시 = 백엔드(Rust) 모듈 실행 실패
- 둘 다 수정해야 완전히 작동함!
